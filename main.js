(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{h:()=>$});const t=document.querySelector(".cards"),r=document.querySelector("#profileEdit"),a=document.querySelector("#newCard"),o=document.querySelector("#newAvatar"),s=document.querySelector("#deleteCard"),n=document.querySelector("#cardZoom"),i=document.querySelector("#card-template").content,c=document.querySelector(".profile__avatar"),d=document.querySelector(".profile__name"),l=document.querySelector(".profile__description"),u=r.querySelector(".form"),m=a.querySelector(".form"),h=o.querySelector(".form"),_=u.querySelector("input[name='name']"),p=u.querySelector("input[name='description']"),v=m.querySelector("input[name='title']"),f=m.querySelector("input[name='link']"),y=document.querySelector(".profile__edit-button"),b=h.querySelector("input[name='avatar-link']"),S=n.querySelector(".popup__overlay"),g=n.querySelector(".popup__image"),C=document.querySelector(".popup__caption"),q={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_error",errorClass:"form__input-error_active"};class L{constructor(e){this.name=e.name,this.about=e.about,this.avatar=e.avatar,this.id=e._id}setUserInfo(){console.log(this)}getUserInfo(){return $.getProfileInfo()}renderUserInfo(){c.src=this.avatar,d.textContent=this.name,l.textContent=this.about}}const k=(e,t)=>{e.disabled=!0,e.classList.add(t)},E=(e,t,r)=>{(e=>e.some((e=>!e.validity.valid)))(e)?k(t,r):(t.disabled=!1,t.classList.remove(r))},x=e=>{e.classList.add("popup_opened"),document.addEventListener("keydown",U)},I=e=>{e.classList.remove("popup_opened"),document.removeEventListener("keydown",U)};function U(e){if("Escape"===e.key){const e=document.querySelector(".popup_opened");I(e)}}n.addEventListener("click",(e=>{(e.target.classList.contains("popup__overlay")||e.target.classList.contains("popup__close-button")||e.target.classList.contains("popup__image"))&&I(n)}));const D=(e,t)=>{const r=i.querySelector(".card").cloneNode(!0);r.dataset.cardId=e._id,r.querySelector(".card__delete-button").dataset.cardId=e._id,e.owner._id===t?r.querySelector(".card__delete-button").addEventListener("click",(()=>{s.querySelector(".form__submit").dataset.cardId=e._id,x(s)})):r.querySelector(".card__delete-button").remove();const a=r.querySelector(".card__image");a.src=e.link,a.alt=e.name,a.dataset.userId=e.owner._id,a.addEventListener("click",(()=>(e=>{g.src=e.link,g.alt=e.name,C.textContent=e.name,S.style.backgroundColor="rgba(0, 0, 0, 0.9)",x(n)})(e))),r.querySelector(".card__title").textContent=e.name;const o=r.querySelector(".card__like"),c=r.querySelector(".card__like-counter");return c.textContent=e.likes.length,e.likes.some((e=>e._id===t))&&o.classList.add("card__like_active"),o.addEventListener("click",(t=>{t.target.classList.contains("card__like_active")?$.deleteLike(e._id).then((e=>{t.target.classList.remove("card__like_active"),c.textContent=e.likes.length})).catch((e=>console.log(e))):$.addLike(e._id).then((e=>{t.target.classList.add("card__like_active"),c.textContent=e.likes.length})).catch((e=>console.log(e)))})),r};s.addEventListener("submit",(function(e){const t=e.submitter.getAttribute("data-card-id");$.deleteCard(t).then((()=>{I(s),document.querySelector(`.card[data-card-id="${t}"]`).remove()})).catch((e=>console.log(e)))}));class P{constructor({items:e,renderer:t},r){this._items=e,this._renderer=t,this._selector=r}addItem(e){this._selector.prepend(e)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}}const $=new class{constructor(e){this.baseUrl=e.baseUrl,this.headers=e.headers}_getData(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getInitialCards(){return fetch(`${this.baseUrl}cards`,{headers:this.headers}).then((e=>this._getData(e)))}getProfileInfo(){return fetch(`${this.baseUrl}users/me`,{headers:this.headers}).then((e=>this._getData(e)))}updateProfileInfo(e){return fetch(`${this.baseUrl}users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((e=>this._getData(e)))}updateProfileAvatar(e){return fetch(`${this.baseUrl}users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then((e=>this._getData(e)))}addCard(e){return fetch(`${this.baseUrl}cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((e=>this._getData(e)))}deleteCard(e){return fetch(`${this.baseUrl}cards/${e}`,{method:"DELETE",headers:this.headers}).then((e=>this._getData(e)))}addLike(e){return fetch(`${this.baseUrl}cards/likes/${e}`,{method:"PUT",headers:this.headers}).then((e=>this._getData(e)))}deleteLike(e){return fetch(`${this.baseUrl}cards/likes/${e}`,{method:"DELETE",headers:this.headers}).then((e=>this._getData(e)))}}({baseUrl:"https://nomoreparties.co/v1/plus-cohort-23/",headers:{authorization:"a9c8f3fa-c4c8-428a-b274-c9fed27107d1","Content-Type":"application/json; charset=UTF-8"}}),w=e=>{e.addEventListener("click",(t=>{(t.target.classList.contains("popup__overlay")||t.target.classList.contains("popup__close-button"))&&I(e)}))};w(r),w(a),w(o),w(s),y.addEventListener("click",(()=>{_.value=d.textContent,p.value=l.textContent,x(r)})),u.addEventListener("submit",(function(e){e.preventDefault(),e.submitter.textContent="Сохранение...";const t={name:_.value,about:p.value};$.updateProfileInfo(t).then((e=>{d.textContent=e.name,l.textContent=e.about,I(r)})).catch((e=>console.log(e))).finally((()=>e.submitter.textContent="Сохранить"))})),document.querySelector(".profile__add-button").addEventListener("click",(()=>{x(a)})),m.addEventListener("submit",(function(e){e.preventDefault(),e.submitter.textContent="Сохранение...",k(e.submitter,q.inactiveButtonClass);const r={};r.name=v.value,r.link=f.value,$.addCard(r).then((e=>{I(a),m.reset(),t.prepend(D(e,e.owner._id))})).catch((e=>console.log(e))).finally((()=>{e.submitter.textContent="Сохранить"}))})),document.querySelector(".profile__avatar-overlay").addEventListener("click",(()=>{x(o)})),o.addEventListener("submit",(function(e){e.preventDefault(),e.submitter.textContent="Сохранение...",console.log(b.value),k(e.submitter,q.inactiveButtonClass),$.updateProfileAvatar(b.value).then((e=>{c.src=e.avatar,h.reset(),I(o)})).catch((e=>console.log(e))).finally((()=>e.submitter.textContent="Сохранить"))})),(({formSelector:e,...t})=>{Array.from(document.querySelectorAll(e)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,{inputSelector:t,submitButtonSelector:r,inactiveButtonClass:a,...o})=>{const s=Array.from(e.querySelectorAll(t)),n=e.querySelector(r);E(s,n,a),s.forEach((t=>{t.addEventListener("input",(()=>{((e,t,r)=>{t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?((e,t,r)=>{const a=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),a.classList.remove(r.errorClass),a.textContent=""})(e,t,r):((e,t,r,a)=>{const o=e.querySelector(`#${t.id}-error`);t.classList.add(a.inputErrorClass),o.classList.add(a.errorClass),o.textContent=r})(e,t,t.validationMessage,r)})(e,t,o),E(s,n,a)}))}))})(e,t)}))})(q),Promise.all([$.getProfileInfo(),$.getInitialCards()]).then((([e,r])=>{const a=new L(e),o=new P({items:r.reverse(),renderer:e=>{o.addItem(D(e,a.id))}},t);a.renderUserInfo(),o.renderItems()})).catch((e=>console.log(e)))})();