(()=>{"use strict";class e{constructor(e,t,s,r,i,n){this.id=e._id,this.name=e.name,this.link=e.link,this._likes=e.likes,this._cardOwner=e.owner._id,this._userId=t,this._cardElement=n.querySelector(".card").cloneNode(!0),this._image=this._cardElement.querySelector(".card__image"),this._deleteButton=this._cardElement.querySelector(".card__delete-button"),this._likeButton=this._cardElement.querySelector(".card__like"),this._likeCounter=this._cardElement.querySelector(".card__like-counter"),this._handlerZoom=s,this._handlerRemove=r,this._handlerLikes=i}_setEventListeners(){this._image.addEventListener("click",(()=>this._handlerZoom(this))),this._likeButton.addEventListener("click",(()=>this._handlerLikes(this))),this._deleteButton.addEventListener("click",(()=>this._handlerRemove(this)))}remove(e){this._cardElement.remove()}render(){return this._image.src=this.link,this._image.alt=this.name,this._cardElement.querySelector(".card__title").textContent=this.name,this._cardOwner!==this._userId&&this._deleteButton.remove(),this._likes.some((e=>e._id===this._userId))&&this._likeButton.classList.add("card__like_active"),this._likeCounter.textContent=this._likes.length,this._setEventListeners(),this._cardElement}}class t{constructor(e,t){this._config=e,this._form=t.querySelector(this._config.formSelector),this._inputList=Array.from(this._form.querySelectorAll(this._config.inputSelector)),this._submitButton=this._form.querySelector(this._config.submitButtonSelector),this._inactiveButtonClass=e.inactiveButtonClass,this._errorMessage=e.inputErrorClass,this._errorClass=e.errorClass}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._errorMessage),t.classList.add(this._errorClass),t.textContent=e.validationMessage}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._errorMessage),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.patternMismatch?e.setCustomValidity(e.validationMessage):e.setCustomValidity(""),e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}disableSubmit(){this._submitButton.disabled=!0,this._submitButton.classList.add(this._inactiveButtonClass)}_toggleButtonState(){this._hasInvalidInput(this._inputList)?this.disableSubmit():(this._submitButton.disabled=!1,this._submitButton.classList.remove(this._inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(this._inactiveButtonClass),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inactiveButtonClass)}))}))}errorReset(){this._inputList.forEach((e=>{this._hideInputError(e),this._toggleButtonState(this._inactiveButtonClass)}))}enableValidation(){this._setEventListeners(),this._toggleButtonState()}}class s{constructor(e){this.popup=e,this._closeEscPopup=this._closeEscPopup.bind(this)}open(){this.popup.classList.add("popup_opened"),document.addEventListener("keydown",this._closeEscPopup)}close(){this.popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._closeEscPopup)}_closeEscPopup(e){"Escape"===e.key&&this.close()}_setEventListeners(){this.popup.addEventListener("click",(e=>{(e.target.classList.contains("popup__overlay")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class r extends s{constructor(e,t){super(e),this._form=e.querySelector(".form"),super._setEventListeners(),this._setEventListeners(),this.callback=t}_setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this.callback(e),this._form.reset()}))}close(){this._form.reset(),super.close()}}const i={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_error",errorClass:"form__input-error_active"},n=document.querySelector(".cards"),o=document.querySelector("#profileEdit"),a=document.querySelector("#newCard"),l=document.querySelector("#newAvatar"),c=document.querySelector("#deleteCard"),h=document.querySelector("#cardZoom"),d=document.querySelector("#card-template").content,u=document.querySelector(".profile__avatar"),_=document.querySelector(".profile__name"),m=document.querySelector(".profile__description"),p=o.querySelector(".form"),f=a.querySelector(".form"),v=l.querySelector(".form"),y=p.querySelector("input[name='name']"),g=p.querySelector("input[name='description']"),b=f.querySelector("input[name='title']"),k=f.querySelector("input[name='link']"),C=v.querySelector("input[name='avatar-link']"),E=document.querySelector(".profile__add-button"),S=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__avatar-overlay"),q=new class{constructor(e){this.baseUrl=e.baseUrl,this.headers=e.headers}_getData(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getInitialCards(){return fetch(`${this.baseUrl}cards`,{headers:this.headers}).then((e=>this._getData(e)))}getProfileInfo(){return fetch(`${this.baseUrl}users/me`,{headers:this.headers}).then((e=>this._getData(e)))}updateProfileInfo(e){return fetch(`${this.baseUrl}users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((e=>this._getData(e)))}updateProfileAvatar(e){return fetch(`${this.baseUrl}users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then((e=>this._getData(e)))}addCard(e){return fetch(`${this.baseUrl}cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((e=>this._getData(e)))}deleteCard(e){return fetch(`${this.baseUrl}cards/${e}`,{method:"DELETE",headers:this.headers}).then((e=>this._getData(e)))}addLike(e){return fetch(`${this.baseUrl}cards/likes/${e}`,{method:"PUT",headers:this.headers}).then((e=>this._getData(e)))}deleteLike(e){return fetch(`${this.baseUrl}cards/likes/${e}`,{method:"DELETE",headers:this.headers}).then((e=>this._getData(e)))}}({baseUrl:"https://nomoreparties.co/v1/plus-cohort-23/",headers:{authorization:"a9c8f3fa-c4c8-428a-b274-c9fed27107d1","Content-Type":"application/json; charset=UTF-8"}}),I=new class{constructor({profileAvatar:e,profileName:t,profileDescription:s},r){this.profileAvatar=e,this.profileName=t,this.profileDescription=s,this.api=r}_renderUserInfo(e){this.profileAvatar.src=e.avatar,this.profileName.textContent=e.name,this.profileDescription.textContent=e.about}setUserInfo(e){this.id=e._id,this.name=e.name,this.about=e.about,this.avatar=e.avatar}getUserInfo(){return this.api.getProfileInfo().then((e=>{this.setUserInfo(e),this._renderUserInfo(e)}))}}({profileAvatar:u,profileName:_,profileDescription:m},q),B=new r(o,(function(e){e.submitter.textContent="Сохранение...";const t={name:y.value,about:g.value};q.updateProfileInfo(t).then((e=>{_.textContent=e.name,m.textContent=e.about,B.close()})).catch((e=>console.log(e))).finally((()=>e.submitter.textContent="Сохранить"))})),x=new t(i,o);x.enableValidation(),S.addEventListener("click",(()=>{y.value=_.textContent,g.value=m.textContent,x.errorReset(),B.open()}));const w=new r(l,(function(e){e.submitter.textContent="Сохранение...",q.updateProfileAvatar(C.value).then((e=>{u.src=e.avatar,w.close()})).catch((e=>console.log(e))).finally((()=>e.submitter.textContent="Сохранить"))})),U=new t(i,l);U.enableValidation(),L.addEventListener("click",(()=>{U.disableSubmit(),w.open()}));const P=new r(a,(function(e){e.submitter.textContent="Сохранение...";const t={name:b.value,link:k.value};q.addCard(t).then((e=>{O.addItem(V(e))})).catch((e=>console.log(e))).finally((()=>{P.close(),e.submitter.textContent="Сохранить"}))})),D=new t(i,a);D.enableValidation(),E.addEventListener("click",(()=>{D.errorReset(),P.open()}));const $=new r(c,(function(e){e.submitter.textContent="Удаление...",q.deleteCard($.card.id).then((()=>{$.card.remove()})).catch((e=>console.log(e))).finally((()=>{e.submitter.textContent="Да",$.close()}))}));function A(e){$.open(),$.card=e}const T=new class extends s{constructor(e){super(e),this._image=e.querySelector(".popup__image"),this._caption=e.querySelector(".popup__caption"),this._overlay=e.querySelector(".popup__overlay"),this._setEventListeners()}open(e,t){super.open(),this._image.src=e,this._image.alt=t,this._caption.textContent=t,this._overlay.style.backgroundColor="rgba(0, 0, 0, 0.9)"}_setEventListeners(){super._setEventListeners(),this.popup.addEventListener("click",(e=>{e.target.classList.contains("popup__image")&&this.close()}))}}(h);function M(e){T.open(e.link,e.name)}function N(e){e._likeButton.classList.contains("card__like_active")?q.deleteLike(e.id).then((e=>{this._likeButton.classList.remove("card__like_active"),this._likeCounter.textContent=e.likes.length})).catch((e=>console.log(e))):q.addLike(e.id).then((e=>{this._likeButton.classList.add("card__like_active"),this._likeCounter.textContent=e.likes.length})).catch((e=>console.log(e)))}function V(t){return new e(t,I.id,M,A,N,d).render()}const O=new class{constructor({renderer:e},t){this._renderer=e,this._selector=t}addItem(e){this._selector.prepend(e)}clear(){this._selector.innerHTML=""}renderItems(e){this.clear(),e.forEach((e=>{this.addItem(this._renderer(e))}))}}({renderer:e=>V(e)},n);Promise.all([I.getUserInfo(),q.getInitialCards()]).then((([e,t])=>{O.renderItems(t.reverse())})).catch((e=>console.log(`Ошибка: ${e}`)))})();