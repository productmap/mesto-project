(()=>{"use strict";var e={d:(t,s)=>{for(var i in s)e.o(s,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{Oq:()=>I});class t{constructor(e,t,s,i,r){this._id=e._id,this.name=e.name,this.link=e.link,this._likes=e.likes,this._cardOwner=e.owner._id,this._userId=t,this._cardElement=s.querySelector(".card").cloneNode(!0),this._image=this._cardElement.querySelector(".card__image"),this._deleteButton=this._cardElement.querySelector(".card__delete-button"),this._likeButton=this._cardElement.querySelector(".card__like"),this._likeCounter=this._cardElement.querySelector(".card__like-counter"),this._removeHandler=i,this._removeHandler=this._removeHandler.bind(this),this._handlerLikes=r}_handleZoomCardImage(){I.open(this.link,this.name)}remove(){this._cardElement.remove()}_setEventListeners(){this._image.addEventListener("click",(()=>this._handleZoomCardImage())),this._likeButton.addEventListener("click",(()=>this._handlerLikes())),this._deleteButton.addEventListener("click",(()=>this._removeHandler(this._id,this)))}getCard(){return this}render(){return this._image.src=this.link,this._image.alt=this.name,this._cardElement.querySelector(".card__title").textContent=this.name,this._cardOwner!==this._userId&&this._deleteButton.remove(),this._likes.some((e=>e._id===this._userId))&&this._likeButton.classList.add("card__like_active"),this._likeCounter.textContent=this._likes.length,this._setEventListeners(),this._cardElement}}class s{constructor(e,t){this._config=e,this._form=t.querySelector(this._config.formSelector),this._inputList=Array.from(this._form.querySelectorAll(this._config.inputSelector)),this._submitButton=this._form.querySelector(this._config.submitButtonSelector),this._inactiveButtonClass=e.inactiveButtonClass,this._errorMessage=e.inputErrorClass,this._errorClass=e.errorClass}_showInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.add(this._errorMessage),t.classList.add(this._errorClass),t.textContent=e.validationMessage}_hideInputError(e){const t=this._form.querySelector(`#${e.id}-error`);e.classList.remove(this._errorMessage),t.classList.remove(this._errorClass),t.textContent=""}_checkInputValidity(e){e.validity.patternMismatch?(console.log(e.validationMessage),e.setCustomValidity(e.validationMessage)):e.setCustomValidity(""),e.validity.valid?this._hideInputError(e):this._showInputError(e,e.validationMessage)}_hasInvalidInput(){return this._inputList.some((e=>!e.validity.valid))}disableSubmit(){this._submitButton.disabled=!0,this._submitButton.classList.add(this._inactiveButtonClass)}_toggleButtonState(){this._hasInvalidInput(this._inputList)?this.disableSubmit():(this._submitButton.disabled=!1,this._submitButton.classList.remove(this._inactiveButtonClass))}_setEventListeners(){this._toggleButtonState(this._inactiveButtonClass),this._inputList.forEach((e=>{e.addEventListener("input",(()=>{this._checkInputValidity(e),this._toggleButtonState(this._inactiveButtonClass)}))}))}enableValidation(){this._setEventListeners(),this._toggleButtonState()}}class i{constructor(e){this.popup=e,this._closeEscPopup=this._closeEscPopup.bind(this)}open(){this.popup.classList.add("popup_opened"),document.addEventListener("keydown",this._closeEscPopup)}close(){this.popup.classList.remove("popup_opened"),document.removeEventListener("keydown",this._closeEscPopup)}_closeEscPopup(e){"Escape"===e.key&&this.close()}_setEventListeners(){this.popup.addEventListener("click",(e=>{(e.target.classList.contains("popup__overlay")||e.target.classList.contains("popup__close-button"))&&this.close()}))}}class r extends i{constructor(e,t){super(e),this._form=e.querySelector(".form"),super._setEventListeners(),this._setEventListeners(),this.callback=t}_setEventListeners(){this._form.addEventListener("submit",(e=>{e.preventDefault(),this.callback(e),this._form.reset()}))}close(){this._form.reset(),super.close()}}class o{constructor({items:e,renderer:t},s){this._items=e,this._renderer=t,this._selector=s}addItem(e){this._selector.prepend(e)}renderItems(){this._items.forEach((e=>{this._renderer(e)}))}}const n=document.querySelector(".cards"),a=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__name"),c=document.querySelector(".profile__description"),h=document.querySelector("#profileEdit"),d=document.querySelector("#newCard"),u=document.querySelector("#newAvatar"),_=document.querySelector("#deleteCard"),m=document.querySelector("#cardZoom"),p=document.querySelector("#card-template").content,f=h.querySelector(".form"),v=d.querySelector(".form"),g=u.querySelector(".form"),y=f.querySelector("input[name='name']"),b=f.querySelector("input[name='description']"),S=v.querySelector("input[name='title']"),k=v.querySelector("input[name='link']"),C=g.querySelector("input[name='avatar-link']"),E={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__submit",inactiveButtonClass:"form__submit_disabled",inputErrorClass:"form__input_error",errorClass:"form__input-error_active"},L=new class{constructor(e){this.baseUrl=e.baseUrl,this.headers=e.headers}_getData(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}getInitialCards(){return fetch(`${this.baseUrl}cards`,{headers:this.headers}).then((e=>this._getData(e)))}getProfileInfo(){return fetch(`${this.baseUrl}users/me`,{headers:this.headers}).then((e=>this._getData(e)))}updateProfileInfo(e){return fetch(`${this.baseUrl}users/me`,{method:"PATCH",headers:this.headers,body:JSON.stringify({name:e.name,about:e.about})}).then((e=>this._getData(e)))}updateProfileAvatar(e){return fetch(`${this.baseUrl}users/me/avatar`,{method:"PATCH",headers:this.headers,body:JSON.stringify({avatar:e})}).then((e=>this._getData(e)))}addCard(e){return fetch(`${this.baseUrl}cards`,{method:"POST",headers:this.headers,body:JSON.stringify({name:e.name,link:e.link})}).then((e=>this._getData(e)))}deleteCard(e){return fetch(`${this.baseUrl}cards/${e}`,{method:"DELETE",headers:this.headers}).then((e=>this._getData(e)))}addLike(e){return fetch(`${this.baseUrl}cards/likes/${e}`,{method:"PUT",headers:this.headers}).then((e=>this._getData(e)))}deleteLike(e){return fetch(`${this.baseUrl}cards/likes/${e}`,{method:"DELETE",headers:this.headers}).then((e=>this._getData(e)))}}({baseUrl:"https://nomoreparties.co/v1/plus-cohort-23/",headers:{authorization:"a9c8f3fa-c4c8-428a-b274-c9fed27107d1","Content-Type":"application/json; charset=UTF-8"}}),q=new class{constructor({profileAvatar:e,profileName:t,profileDescription:s},i){this._profileAvatar=e,this._profileName=t,this._profileDescription=s,this.api=i,this.getUserInfo()}_updateProfileInfo(){this._profileAvatar.src=this.avatar,this._profileName.textContent=this.name,this._profileDescription.textContent=this.about}_updateSession(){sessionStorage.setItem("user",JSON.stringify(this.info))}_getSession(){return JSON.parse(sessionStorage.getItem("user"))}setUserInfo(e){this.info=e,this.name=e.name,this.about=e.about,this.avatar=e.avatar,this.id=e._id,this._updateProfileInfo(),this._updateSession(this.info)}getUserInfo(){return this._getSession()?this._getSession():this.api.getProfileInfo().then((e=>e)).catch((e=>console.log(e)))}updateUserInfo(e){this._updateProfileInfo(),this._updateSession(this.info)}}({profileAvatar:a,profileName:l,profileDescription:c},L),I=new class extends i{constructor(e){super(e),this._image=e.querySelector(".popup__image"),this._caption=e.querySelector(".popup__caption"),this._overlay=e.querySelector(".popup__overlay"),this._setEventListeners()}open(e,t){super.open(),this._image.src=e,this._image.alt=t,this._caption.textContent=t,this._overlay.style.backgroundColor="rgba(0, 0, 0, 0.9)"}_setEventListeners(){super._setEventListeners(),this.popup.addEventListener("click",(e=>{e.target.classList.contains("popup__image")&&this.close()}))}}(m),B=new r(h,(function(e){e.submitter.textContent="Сохранение...";const t={name:y.value,about:b.value};L.updateProfileInfo(t).then((e=>{l.textContent=e.name,c.textContent=e.about,B.close()})).catch((e=>console.log(e))).finally((()=>e.submitter.textContent="Сохранить"))})),w=document.querySelector(".profile__edit-button");new s(E,h).enableValidation(),w.addEventListener("click",(()=>{y.value=l.textContent,b.value=c.textContent,B.open()}));const P=new r(u,(function(e){e.submitter.textContent="Сохранение...",L.updateProfileAvatar(C.value).then((e=>{a.src=e.avatar,P.close()})).catch((e=>console.log(e))).finally((()=>e.submitter.textContent="Сохранить"))})),x=document.querySelector(".profile__avatar-overlay"),U=new s(E,u);x.addEventListener("click",(()=>{U.enableValidation(),U.disableSubmit(),P.open()}));const D=new r(d,(function(e){e.submitter.textContent="Сохранение...";const t={name:S.value,link:k.value};L.addCard(t).then((e=>{D.close(),n.prepend(createCard(e,e.owner._id))})).catch((e=>console.log(e))).finally((()=>{e.submitter.textContent="Сохранить"}))})),$=document.querySelector(".profile__add-button"),O=new s(E,d);$.addEventListener("click",(()=>{D.open(),O.enableValidation(),O.disableSubmit()}));const A=new r(_,(e=>{_.addEventListener("submit",(e=>{}))}));function N(e){A.open(),L.deleteCard(e.id).then((()=>{e.remove(),A.close()})).catch((e=>console.log(e))).finally((()=>{}))}function M(e){e._likeButton.classList.contains("card__like_active")?L.deleteLike(this._id).then((e=>{this._likeButton.classList.remove("card__like_active"),this._likeCounter.textContent=e.likes.length})).catch((e=>console.log(e))):L.addLike(this._id).then((e=>{this._likeButton.classList.add("card__like_active"),this._likeCounter.textContent=e.likes.length})).catch((e=>console.log(e)))}Promise.all([q.getUserInfo(),L.getInitialCards()]).then((([e,s])=>{q.setUserInfo(e);const i=new o({items:s.reverse(),renderer:e=>{const s=new t(e,q.id,p,N,M);i.addItem(s.render(e,q.id,p))}},n);i.renderItems()})).catch((e=>console.log(`Ошибка: ${e}`)))})();